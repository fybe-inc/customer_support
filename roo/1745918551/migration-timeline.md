# Supabase認証システム移行タイムライン

このドキュメントでは、現在のSupabase認証システムからsupabase-frameベースの実装への移行タイムラインを提案します。移行は段階的に行い、各フェーズでテストを実施することで、リスクを最小限に抑えます。

## 全体タイムライン

| フェーズ | 期間 | 説明 |
|---------|------|------|
| 準備    | 1週目 | 環境構築、計画の詳細化 |
| フェーズ1 | 2週目 | 基本的なクライアント実装 |
| フェーズ2 | 3週目 | ミドルウェアと認証コンポーネントの更新 |
| フェーズ3 | 4週目 | APIルートとデータフックの更新 |
| テスト  | 5週目 | 総合テストと問題修正 |
| デプロイ | 6週目 | 本番環境への展開 |
| 後方互換性の削除 | 7週目 | 古いコードの削除とクリーンアップ |

## 詳細タイムライン

### 準備（1週目）

#### 1日目: 環境構築
- 開発環境のセットアップ
- 必要なパッケージのインストール（`@supabase/ssr`）
- 開発ブランチの作成

#### 2-3日目: 詳細計画
- 移行対象のファイルの特定
- 依存関係の分析
- テスト計画の作成

#### 4-5日目: プロトタイプ作成
- 基本的なクライアント実装のプロトタイプ作成
- 簡単な動作確認

### フェーズ1: 基本的なクライアント実装（2週目）

#### 1-2日目: ディレクトリ構造の作成
- `frontend/src/utils/supabase/`ディレクトリの作成
- `client.ts`と`server.ts`の実装

#### 3-5日目: 基本機能のテスト
- クライアント作成関数のテスト
- 基本的な認証機能のテスト（ログイン、ログアウト）
- 問題の修正

### フェーズ2: ミドルウェアと認証コンポーネントの更新（3週目）

#### 1-2日目: ミドルウェアの更新
- `middleware.ts`の更新
- ルート保護機能のテスト

#### 3-5日目: 認証コンポーネントの更新
- `Login.tsx`の更新
- `SignUp.tsx`の更新
- `LogoutButton.tsx`の更新
- `AuthContext.tsx`の作成（必要な場合）
- コンポーネントのテスト

### フェーズ3: APIルートとデータフックの更新（4週目）

#### 1-2日目: APIルートの更新
- `getResponse/route.ts`の更新
- `user-session/route.ts`の作成
- APIルートのテスト

#### 3-5日目: データフックの更新
- `useSupabaseManuals`の更新
- `useSupabaseProducts`の更新
- `useSupabaseScenarios`の更新
- データフックのテスト

### テスト（5週目）

#### 1-3日目: 総合テスト
- エンドツーエンドテスト
- ユーザーフローのテスト
- エッジケースのテスト

#### 4-5日目: 問題修正
- テスト中に発見された問題の修正
- パフォーマンスの最適化

### デプロイ（6週目）

#### 1-2日目: ステージング環境へのデプロイ
- ステージング環境の準備
- 新しいコードのデプロイ
- ステージング環境でのテスト

#### 3-5日目: 本番環境へのデプロイ
- デプロイ計画の作成
- 本番環境へのデプロイ
- デプロイ後のモニタリング

### 後方互換性の削除（7週目）

#### 1-3日目: 古いコードの削除
- 不要なパッケージのアンインストール
- 古いファイルの削除または更新
- コードのクリーンアップ

#### 4-5日目: 最終確認
- 最終テスト
- ドキュメントの更新
- プロジェクトの完了レビュー

## マイルストーン

1. **基本的なクライアント実装の完了**（2週目終了時）
   - 新しいSupabaseクライアント作成関数が実装され、基本的な認証機能が動作する

2. **認証システムの更新完了**（3週目終了時）
   - ミドルウェアと認証コンポーネントが更新され、ユーザーがログイン、サインアップ、ログアウトできる

3. **APIとデータフックの更新完了**（4週目終了時）
   - すべてのAPIルートとデータフックが新しいクライアント作成関数を使用するように更新される

4. **テスト完了**（5週目終了時）
   - すべてのテストが成功し、問題が修正される

5. **本番環境へのデプロイ完了**（6週目終了時）
   - 新しいコードが本番環境にデプロイされ、正常に動作している

6. **プロジェクト完了**（7週目終了時）
   - 古いコードが削除され、プロジェクトがクリーンアップされる

## 進捗管理

- 毎週、進捗状況を確認するミーティングを開催
- 各フェーズの終了時に、完了したタスクと残りのタスクを確認
- 問題が発生した場合は、すぐに対応し、必要に応じてタイムラインを調整

## 注意事項

- このタイムラインは目安であり、プロジェクトの複雑さや発生する問題によって調整が必要になる場合があります
- 各フェーズでのテストは非常に重要です。問題を早期に発見し、修正することで、後のフェーズでの問題を防ぎます
- ユーザーへの影響を最小限に抑えるため、デプロイは計画的に行います