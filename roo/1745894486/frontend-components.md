# カスタマーサポートアプリケーション コンポーネント詳細

## 1. ページコンポーネント

### 1.1 ホームページ (`frontend/src/app/page.tsx`)

ホームページは、アプリケーションのメインページです。ユーザーからの問い合わせを入力し、AIからの回答を表示します。

**主な機能**:
- `InquiryForm` コンポーネントを使用して問い合わせを入力
- `AIResponseDisplay` コンポーネントを使用してAIの回答を表示
- `useLocalStorage` フックを使用してマニュアル、商品情報、シナリオをローカルストレージから取得
- APIエンドポイント (`/api/getResponse`) にリクエストを送信

**状態管理**:
- `aiResponse`: AIからの応答を保持する状態
- ローカルストレージから取得したマニュアル、商品情報、シナリオ

**データフロー**:
1. ユーザーが問い合わせを入力し、送信ボタンをクリック
2. ローカルストレージからマニュアル、商品情報、シナリオを取得
3. APIエンドポイントにリクエストを送信
4. 応答を受け取り、`aiResponse` 状態を更新
5. `AIResponseDisplay` コンポーネントに応答を渡して表示

### 1.2 マニュアル管理ページ (`frontend/src/app/manual/page.tsx`)

マニュアル管理ページでは、カスタマーサポートのマニュアル情報を管理します。

**主な機能**:
- マニュアル情報の追加・削除
- `useLocalStorage` フックを使用してマニュアル情報をローカルストレージに保存

**状態管理**:
- `manuals`: ローカルストレージから取得したマニュアル情報の配列
- `content`: 新しいマニュアル情報の入力内容

**データフロー**:
1. ユーザーがマニュアル情報を入力し、保存ボタンをクリック
2. 新しいマニュアルエントリーを作成し、`manuals` 配列に追加
3. 更新された `manuals` 配列をローカルストレージに保存
4. マニュアル一覧を表示し、削除ボタンで個別のマニュアルを削除可能

### 1.3 商品情報管理ページ (`frontend/src/app/products/page.tsx`)

商品情報管理ページでは、ECサイトの商品情報を管理します。

**主な機能**:
- 商品情報の追加・削除
- `useLocalStorage` フックを使用して商品情報をローカルストレージに保存

**状態管理**:
- `products`: ローカルストレージから取得した商品情報の配列
- `content`: 新しい商品情報の入力内容

**データフロー**:
1. ユーザーが商品情報を入力し、保存ボタンをクリック
2. 新しい商品エントリーを作成し、`products` 配列に追加
3. 更新された `products` 配列をローカルストレージに保存
4. 商品情報一覧を表示し、削除ボタンで個別の商品情報を削除可能

### 1.4 シナリオ管理ページ (`frontend/src/app/scenarios/page.tsx`)

シナリオ管理ページでは、カスタマーサポートの事前定義シナリオを管理します。

**主な機能**:
- シナリオの追加・削除
- `useLocalStorage` フックを使用してシナリオをローカルストレージに保存

**状態管理**:
- `scenarios`: ローカルストレージから取得したシナリオの配列
- `title`: 新しいシナリオのタイトル
- `prompt`: 新しいシナリオのプロンプト

**データフロー**:
1. ユーザーがシナリオのタイトルとプロンプトを入力し、保存ボタンをクリック
2. 新しいシナリオを作成し、`scenarios` 配列に追加
3. 更新された `scenarios` 配列をローカルストレージに保存
4. シナリオ一覧を表示し、削除ボタンで個別のシナリオを削除可能

## 2. 機能コンポーネント

### 2.1 問い合わせフォーム (`frontend/src/components/InquiryForm.tsx`)

問い合わせフォームは、ユーザーからの問い合わせを入力するためのコンポーネントです。

**プロパティ**:
- `onSubmit`: 問い合わせを送信する関数

**状態管理**:
- `inquiry`: 問い合わせ内容
- `isLoading`: 送信中かどうかを示すフラグ

**機能**:
- テキストエリアで問い合わせ内容を入力
- 送信ボタンで問い合わせを送信
- 送信中はローディング状態を表示し、フォームを無効化

### 2.2 AI応答表示 (`frontend/src/components/AIResponseDisplay.tsx`)

AI応答表示は、APIから返されたAI応答（複数のシナリオ）を表示するコンポーネントです。

**プロパティ**:
- `response`: AIの応答（複数のシナリオを含む）

**状態管理**:
- `copyStatuses`: 各シナリオのコピー状態を管理するオブジェクト

**機能**:
- 複数のシナリオを表示
- 各シナリオについて、返信メッセージ、シナリオタイプ、補足情報を表示
- 返信メッセージをクリップボードにコピーする機能
- シナリオの感情（positive、negative、neutral）に応じて色分け表示

### 2.3 シナリオ管理 (`frontend/src/components/ScenarioManagement.tsx`)

シナリオ管理は、シナリオの追加・削除・選択を行うコンポーネントです。

**プロパティ**:
- `onScenarioSelect`: シナリオが選択されたときに呼び出される関数
- `selectedScenario`: 現在選択されているシナリオ
- `scenarios`: シナリオの配列
- `setScenarios`: シナリオの配列を更新する関数

**状態管理**:
- `newScenario`: 新しいシナリオの入力内容

**機能**:
- シナリオのタイトルとプロンプトを入力するフォーム
- シナリオの追加・削除
- シナリオの選択（クリックで選択・選択解除）

### 2.4 AIシナリオセレクター (`frontend/src/components/AIScenarioSelector.tsx`)

AIシナリオセレクターは、AIが提案するシナリオの一覧を表示し、選択できるようにするコンポーネントです。

**プロパティ**:
- `scenarios`: AIが提案するシナリオの配列
- `onSelect`: シナリオが選択されたときに呼び出される関数

**機能**:
- AIが提案するシナリオの一覧を表示
- 各シナリオについて、シナリオタイプ、返信内容、補足情報、感情を表示
- シナリオをクリックして選択

## 3. レイアウトコンポーネント

### 3.1 ルートレイアウト (`frontend/src/app/layout.tsx`)

ルートレイアウトは、アプリケーション全体のレイアウトを定義するコンポーネントです。

**機能**:
- Geistフォントの適用
- Navbarコンポーネントの表示
- メインコンテンツ領域の定義

### 3.2 ナビゲーションバー (`frontend/src/components/Navbar.tsx`)

ナビゲーションバーは、アプリケーションのナビゲーションを提供するコンポーネントです。

**機能**:
- サイドバーナビゲーションの表示
- 各ページへのリンク（ホーム、マニュアル管理、事前シナリオ、商品情報管理）

## 4. カスタムフック

### 4.1 useLocalStorage (`frontend/src/hooks/useLocalStorage.ts`)

useLocalStorageは、ローカルストレージとReactの状態を同期させるカスタムフックです。

**パラメータ**:
- `key`: ローカルストレージのキー
- `initialValue`: 初期値

**戻り値**:
- `[storedValue, setValue]`: 現在の値と値を更新する関数のタプル

**機能**:
- ローカルストレージから値を取得し、状態として保持
- 値を設定する関数を提供し、状態とローカルストレージの両方を更新
- サーバーサイドレンダリング対応のため、`typeof window === 'undefined'` のチェックを行う

## 5. APIエンドポイント

### 5.1 getResponse (`frontend/src/app/api/getResponse/route.ts`)

getResponseは、OpenAIのAPIを呼び出し、AIの応答を生成するAPIエンドポイントです。

**リクエスト**:
- `inquiry`: 問い合わせ内容
- `manuals`: マニュアル情報の配列
- `products`: 商品情報の配列
- `scenarios`: シナリオの配列

**レスポンス**:
- `scenarios`: AIが生成したシナリオの配列

**処理フロー**:
1. リクエストからデータを取得
2. システムプロンプトを構築
3. OpenAIのAPIを呼び出し
4. 応答を処理し、JSON形式でフロントエンドに返す
5. エラーハンドリング（応答拒否、不完全な応答、コンテンツフィルター）

## 6. 実装上の特徴

### 6.1 ローカルストレージの活用

このアプリケーションでは、サーバーサイドのデータベースを使用せず、ローカルストレージを活用してデータを保存しています。これにより、以下のメリットがあります：

- サーバーサイドの実装が簡素化される
- オフライン環境でも一部機能が利用可能
- ユーザーごとに異なる設定を保存可能

ただし、以下の制限もあります：

- ブラウザ間でデータが共有されない
- ストレージ容量に制限がある
- セキュリティ上の懸念（機密情報の保存には不適切）

### 6.2 OpenAI APIの活用

OpenAIのAPIを活用して、以下の機能を実現しています：

- 複数のシナリオ生成
- 感情分析（positive、negative、neutral）
- 補足情報の提供

APIリクエストでは、以下の工夫をしています：

- システムプロンプトにマニュアル、商品情報、シナリオを含める
- Function callingを使用して構造化された応答を取得
- エラーハンドリングを実装

### 6.3 コンポーネント設計

コンポーネント設計では、以下の原則に従っています：

- 単一責任の原則：各コンポーネントは1つの責任を持つ
- 再利用性：汎用的なコンポーネントを作成し、複数の場所で使用
- 状態の局所化：状態は必要な最小限のスコープで管理
- プロップスによるデータフロー：親から子へのデータ伝達はプロップスを使用

## 7. 今後の改善点

### 7.1 パフォーマンス最適化

- コンポーネントのメモ化（React.memo、useMemo、useCallback）
- 画像の最適化
- コード分割とレイジーローディング

### 7.2 ユーザー体験の向上

- ダークモード対応
- アクセシビリティの改善
- レスポンシブデザインの強化
- アニメーションの追加

### 7.3 機能拡張

- ユーザー認証の追加
- データベースとの連携
- リアルタイム通知
- 多言語対応
- 履歴管理機能