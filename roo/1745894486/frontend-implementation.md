# カスタマーサポートアプリケーション フロントエンド実装概要

## 1. アプリケーション概要

このアプリケーションは、AI共同型カスタマーサポート簡素化システムです。OpenAIのChatCompletion APIを利用して返信候補を自動生成し、オペレーターが最終的な返信を行う形のWebアプリケーションです。

## 2. ページ構成

Next.jsのApp Routerを使用した以下のページ構成になっています：

### 2.1 ホームページ (`/`)

- **ファイル**: `frontend/src/app/page.tsx`
- **機能**: 
  - ユーザーからの問い合わせを入力するフォームを表示
  - AIからの回答を表示
  - ローカルストレージから取得したマニュアル、商品情報、シナリオをAPIリクエストに含める

### 2.2 マニュアル管理ページ (`/manual`)

- **ファイル**: `frontend/src/app/manual/page.tsx`
- **機能**:
  - マニュアル情報の追加・削除
  - ローカルストレージにマニュアル情報を保存

### 2.3 商品情報管理ページ (`/products`)

- **ファイル**: `frontend/src/app/products/page.tsx`
- **機能**:
  - 商品情報の追加・削除
  - ローカルストレージに商品情報を保存

### 2.4 シナリオ管理ページ (`/scenarios`)

- **ファイル**: `frontend/src/app/scenarios/page.tsx`
- **機能**:
  - シナリオ（タイトルとプロンプト）の追加・削除
  - ローカルストレージにシナリオを保存

### 2.5 APIエンドポイント (`/api/getResponse`)

- **ファイル**: `frontend/src/app/api/getResponse/route.ts`
- **機能**:
  - フロントエンドから送信された問い合わせ内容、マニュアル、商品情報、シナリオを受け取る
  - OpenAIのAPIを呼び出し、複数のシナリオを生成
  - 生成されたシナリオをJSON形式でフロントエンドに返す

## 3. コンポーネント構成

### 3.1 レイアウト関連

#### 3.1.1 ルートレイアウト
- **ファイル**: `frontend/src/app/layout.tsx`
- **機能**:
  - アプリケーション全体のレイアウトを定義
  - Navbarコンポーネントを表示
  - Geistフォントを適用

#### 3.1.2 ナビゲーションバー
- **ファイル**: `frontend/src/components/Navbar.tsx`
- **機能**:
  - サイドバーナビゲーションを提供
  - 各ページへのリンクを表示（ホーム、マニュアル管理、事前シナリオ、商品情報管理）

### 3.2 機能コンポーネント

#### 3.2.1 問い合わせフォーム
- **ファイル**: `frontend/src/components/InquiryForm.tsx`
- **機能**:
  - ユーザーからの問い合わせ内容を入力するためのテキストエリアを提供
  - 送信ボタンを押すと、親コンポーネントから渡された `onSubmit` 関数を呼び出し

#### 3.2.2 AI応答表示
- **ファイル**: `frontend/src/components/AIResponseDisplay.tsx`
- **機能**:
  - APIから返されたAI応答（複数のシナリオ）を表示
  - 各シナリオについて、返信メッセージ、シナリオタイプ、補足情報を表示
  - 返信メッセージをクリップボードにコピーする機能を提供
  - シナリオの感情（positive、negative、neutral）に応じて色分け表示

#### 3.2.3 シナリオ管理
- **ファイル**: `frontend/src/components/ScenarioManagement.tsx`
- **機能**:
  - シナリオのタイトルとプロンプトを入力するフォームを提供
  - 既存のシナリオを一覧表示し、削除機能を提供
  - 選択されたシナリオをハイライト表示

#### 3.2.4 AIシナリオセレクター
- **ファイル**: `frontend/src/components/AIScenarioSelector.tsx`
- **機能**:
  - AIが提案するシナリオの一覧を表示
  - 各シナリオについて、シナリオタイプ、返信内容、補足情報、感情を表示
  - シナリオをクリックすると、親コンポーネントから渡された `onSelect` 関数を呼び出し

## 4. カスタムフック

### 4.1 useLocalStorage
- **ファイル**: `frontend/src/hooks/useLocalStorage.ts`
- **機能**:
  - ローカルストレージから値を取得し、状態として保持
  - 値を設定する関数を提供し、状態とローカルストレージの両方を更新
  - サーバーサイドレンダリング対応のため、`typeof window === 'undefined'` のチェックを行う

## 5. 型定義

- **ファイル**: `frontend/src/types/types.ts`
- **主な型**:
  - `AIScenario`: AIが生成するシナリオの型（返信内容、シナリオタイプ、補足情報、感情）
  - `AIResponse`: AIの応答の型（複数のシナリオを含む）
  - `ManualEntry`: マニュアルエントリーの型（ID、内容、タイムスタンプ）
  - `ProductEntry`: 商品エントリーの型（ID、内容、タイムスタンプ）
  - `Scenario`: シナリオの型（ID、タイトル、プロンプト）
  - `InquiryRequest`: 問い合わせリクエストの型（問い合わせ内容、マニュアル、商品、シナリオ）

## 6. データフロー

1. ユーザーが問い合わせ内容を入力し、送信ボタンをクリック
2. フロントエンドはローカルストレージからマニュアル、商品情報、シナリオを取得
3. これらの情報と問い合わせ内容をAPIエンドポイント（`/api/getResponse`）に送信
4. APIエンドポイントはOpenAIのAPIを呼び出し、複数のシナリオを生成
5. 生成されたシナリオをJSON形式でフロントエンドに返す
6. フロントエンドは受け取ったシナリオを表示
7. ユーザーは適切なシナリオを選択し、必要に応じて編集して顧客に返信

## 7. 特徴

1. **ローカルストレージの活用**:
   - マニュアル、商品情報、シナリオをローカルストレージに保存
   - サーバーサイドのデータベースを使用せず、クライアントサイドで完結

2. **複数シナリオの提案**:
   - AIは事前定義されたシナリオと追加提案シナリオを生成
   - 各シナリオには返信メッセージ、シナリオタイプ、補足情報、感情が含まれる

3. **レスポンシブデザイン**:
   - Tailwind CSSを使用したレスポンシブなUI
   - サイドバーナビゲーションとメインコンテンツ領域の2カラムレイアウト

4. **エラーハンドリング**:
   - APIリクエスト失敗時のエラーメッセージ表示
   - OpenAIのAPIからの応答拒否、不完全な応答、コンテンツフィルターによる制限に対応

## 8. 今後の拡張可能性

1. **Webhook連携**:
   - 外部のカスタマーサポートツールやチャットツールとの連携

2. **多言語対応**:
   - システムプロンプトに言語指定を追加し、多言語での回答生成に対応

3. **ログ分析・FAQ自動生成**:
   - よくある質問パターンをAIが自動抽出・生成し、商品詳細プロンプトやシナリオリストへ追加する仕組みを構築